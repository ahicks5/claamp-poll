{% extends "base.html" %}
{% block title %}Polls{% endblock %}
{% block content %}

<section class="container">

  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">College Football Polls</h1>
      <p class="page-subtitle muted">Vote on the current poll or browse historical results</p>
    </div>
    {% if current_user.is_authenticated and current_user.is_admin %}
      <div>
        <a class="btn btn-ghost" href="{{ url_for('poll.admin_panel') }}">Admin Panel</a>
      </div>
    {% endif %}
  </div>

  <!-- Polls Grid -->
  {% if polls %}
    <div class="polls-grid">
      {% for poll in polls %}
        <div class="poll-card {% if poll.is_open %}poll-card--open{% endif %}">

          <!-- Poll Header -->
          <div class="poll-card__header">
            <div class="poll-card__meta">
              <span class="poll-card__season">{{ poll.season }}</span>
              <span class="poll-card__divider">â€¢</span>
              <span class="poll-card__week">Week {{ poll.week }}</span>
            </div>
            {% if poll.is_open %}
              <span class="pill pill-live">Open</span>
            {% else %}
              <span class="pill pill-muted">Closed</span>
            {% endif %}
          </div>

          <!-- Poll Title -->
          <h2 class="poll-card__title">{{ poll.title }}</h2>

          <!-- Poll Stats -->
          <div class="poll-card__stats">
            <div class="stat-item">
              <span class="stat-label">Ballots</span>
              <span class="stat-value">{{ ballot_counts.get(poll.id, 0) }}</span>
            </div>
            {% set user_ballot = user_ballots.get(poll.id) %}
            {% if poll.is_open and user_ballot and user_ballot.submitted_at %}
              <div class="stat-item">
                <span class="stat-badge stat-badge--success">âœ“ You voted</span>
              </div>
            {% elif poll.is_open %}
              <div class="stat-item">
                <span class="stat-badge stat-badge--warning">Awaiting your vote</span>
              </div>
            {% endif %}
          </div>

          <!-- Poll Actions -->
          <div class="poll-card__actions">
            {% if poll.is_open %}
              <a href="{{ url_for('poll.vote_form', poll_id=poll.id) }}" class="btn btn-primary">
                {% if user_ballot and user_ballot.submitted_at %}
                  Edit Ballot
                {% else %}
                  Vote Now
                {% endif %}
              </a>
              <a href="{{ url_for('poll.results', poll_id=poll.id) }}" class="btn btn-ghost">
                View Results
              </a>
            {% else %}
              <a href="{{ url_for('poll.results', poll_id=poll.id) }}" class="btn btn-primary">
                View Results
              </a>
            {% endif %}
          </div>

        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="card">
      <div class="empty-state">
        <p class="empty-state__icon">ðŸ“Š</p>
        <h3 class="empty-state__title">No polls yet</h3>
        <p class="empty-state__message muted">Check back soon for the first poll!</p>
        {% if current_user.is_authenticated and current_user.is_admin %}
          <a href="{{ url_for('poll.admin_panel') }}" class="btn btn-primary mt-2">Create First Poll</a>
        {% endif %}
      </div>
    </div>
  {% endif %}

</section>

<style>
/* Page Header */
.page-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 24px;
}
.page-title {
  font-size: 2rem;
  font-weight: 700;
  margin: 0;
  line-height: 1.2;
}
.page-subtitle {
  font-size: 1rem;
  margin: 8px 0 0 0;
}

/* Polls Grid */
.polls-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

/* Poll Card */
.poll-card {
  background: var(--panel-2, #10141c);
  border: 1px solid var(--line, #1f2633);
  border-radius: 12px;
  padding: 20px;
  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
}
.poll-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.poll-card--open {
  border-color: var(--brand, #6ee7ff);
  box-shadow: 0 0 0 1px var(--brand, #6ee7ff), 0 2px 8px rgba(110, 231, 255, 0.15);
}
.poll-card--open:hover {
  box-shadow: 0 0 0 1px var(--brand, #6ee7ff), 0 6px 16px rgba(110, 231, 255, 0.25);
}

/* Poll Card Header */
.poll-card__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}
.poll-card__meta {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.875rem;
  color: var(--fg-muted, #a8b2c8);
  font-weight: 500;
}
.poll-card__season {
  color: var(--fg, #eaeef7);
}
.poll-card__divider {
  opacity: 0.5;
}

/* Poll Card Title */
.poll-card__title {
  font-size: 1.25rem;
  font-weight: 600;
  margin: 0 0 16px 0;
  line-height: 1.3;
  color: var(--fg, #eaeef7);
}

/* Poll Card Stats */
.poll-card__stats {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 16px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--line, #1f2633);
}
.stat-item {
  display: flex;
  align-items: center;
  gap: 6px;
}
.stat-label {
  font-size: 0.875rem;
  color: var(--fg-muted, #a8b2c8);
}
.stat-value {
  font-size: 1rem;
  font-weight: 600;
  color: var(--fg, #eaeef7);
}
.stat-badge {
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: 500;
}
.stat-badge--success {
  background: rgba(124, 255, 183, 0.15);
  color: #7cffb7;
}
.stat-badge--warning {
  background: rgba(255, 193, 7, 0.15);
  color: #ffc107;
}

/* Poll Card Actions */
.poll-card__actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

/* Status Pills */
.pill {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.pill-live {
  background: rgba(110, 231, 255, 0.15);
  color: var(--brand, #6ee7ff);
  border: 1px solid var(--brand, #6ee7ff);
}
.pill-muted {
  background: rgba(168, 178, 200, 0.1);
  color: var(--fg-muted, #a8b2c8);
  border: 1px solid var(--line, #1f2633);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
}
.empty-state__icon {
  font-size: 4rem;
  margin: 0 0 16px 0;
}
.empty-state__title {
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0 0 8px 0;
}
.empty-state__message {
  font-size: 1rem;
  margin: 0;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    align-items: flex-start;
  }
  .page-title {
    font-size: 1.75rem;
  }
  .polls-grid {
    grid-template-columns: 1fr;
  }
  .poll-card__actions {
    flex-direction: column;
  }
  .poll-card__actions .btn {
    width: 100%;
    justify-content: center;
  }
}
</style>

{% endblock %}
